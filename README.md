# K-Line Waker (K线提醒助手)

K-Line Waker 是一款专为交易员设计的桌面端 K 线周期倒计时提醒工具。它能够帮助你精准把握不同时间周期（如 15分钟、4小时等）的 K 线收盘时间，防止因错过收盘确认而导致的操作失误。

## ✨ 核心功能

### 1. 智能 K 线对齐 (Smart K-Line Alignment)
不同于普通的倒计时工具，本软件内置了基于时钟时间的 K 线对齐算法。
- **机制**：自动计算下一个标准的 K 线收盘时间点。
- **示例**：如果你在 10:07 创建了一个 15 分钟周期的提醒，系统会自动将目标时间设定为 10:15:00，而不是简单的 15 分钟后。
- **支持**：支持任意分钟数的周期设置（预设 15m, 1h, 4h, 日线等，也支持自定义输入）。

### 2. 多任务看板管理
- **卡片式布局**：每个提醒任务以独立的卡片形式展示，清晰直观。
- **实时倒计时**：精确到秒的倒计时显示，配合进度条让你对剩余时间一目了然。
- **多周期并行**：你可以同时监控 BTC 的 15分钟线、ETH 的 4小时线以及其他品种的日线，互不干扰。

### 3. 全方位提醒机制
当倒计时进入你设定的"提前提醒时间"（例如收盘前 30 秒）时，软件会通过多种方式提醒你：
- **视觉警报**：任务卡片背景会开始闪烁，边框变为红色，进度条进入紧急状态。
- **声音提示**：
  - **默认蜂鸣**：内置高频蜂鸣声，穿透力强。
  - **自定义音效**：支持上传你喜欢的 MP3/WAV 音频文件作为提示音（如交易所的成交音效或语音播报）。
- **语音播报 (TTS)**：支持文字转语音播报提醒，可在设置中全局开启/关闭。
- **系统通知**：即使软件处于后台或最小化状态，也会发送操作系统的原生通知弹窗。

### 4. 交易日志模块 (Trading Journal)
- **数据持久化**：使用 NeDB 轻量级数据库存储交易记录，无需额外数据库服务。
- **图片管理**：支持截图粘贴上传，图片文件存储在本地，数据库仅保存文件名，避免 Base64 膨胀。
- **统计面板**：实时显示交易统计（总笔数、胜率、盈亏比等）。
- **快速录入**：通过模态框快速添加交易记录，支持多字段（品种、方向、价格、数量、盈亏、备注等）。
- **视图切换**：侧边栏提供"提醒"和"日志"视图切换，窗口自动调整大小以适配不同内容。

### 5. 个性化定制 (Customization)
- **主题切换**：
  - **模式**：支持 **暗色 (Dark)**、**亮色 (Light)** 以及 **跟随系统** 模式。
  - **主题色**：提供多种强调色（蓝、绿、橙、红、紫等）供选择，打造专属界面。
- **提前提醒设置**：你可以为每个任务单独设置提前多少秒触发报警（默认为 30秒）。

### 6. 桌面增强体验
- **窗口置顶 (Always on Top)**：点击右上角的"图钉"图标，可让窗口始终悬浮在其他交易软件（如 TradingView 或 交易所客户端）之上，方便随时查看。
- **系统托盘运行**：点击关闭按钮不会退出程序，而是最小化到系统托盘区继续运行，确保不会意外杀掉进程导致错过提醒。右键托盘图标可彻底退出。
- **防误删保护**：删除任务时会有二次确认弹窗，防止手误操作。
- **自动窗口调整**：切换到交易日志视图时，窗口自动放大以提供更好的浏览体验；切换回提醒视图时恢复紧凑布局。

## 🛠 技术栈

本项目基于现代化的前端技术栈构建，兼顾性能与开发体验：

- **框架核心**: [Electron](https://www.electronjs.org/) (通过 [Electron-Vite](https://electron-vite.org/) 构建) - 提供跨平台桌面应用能力。
- **用户界面**: [React](https://react.dev/) + [TypeScript](https://www.typescriptlang.org/) - 强类型的组件化开发。
- **样式系统**: [Tailwind CSS](https://tailwindcss.com/) + [shadcn/ui](https://ui.shadcn.com/) - 美观且可定制的 UI 组件库。
- **状态管理**: [Zustand](https://github.com/pmndrs/zustand) - 轻量级状态管理，配合持久化中间件保存用户设置。
- **数据存储**: [NeDB](https://github.com/louischatriot/nedb) - 轻量级嵌入式数据库，用于任务和交易日志持久化。
- **音频技术**: Web Audio API (生成蜂鸣声) & HTML5 Audio (播放自定义文件) & Web Speech API (文字转语音)。

## 🚀 开发与构建

### 环境要求
- Node.js (推荐 v16 或更高版本)
- npm 或 yarn

### 安装依赖

```bash
npm install
```

### 本地开发

启动开发服务器（带有热重载功能）：

```bash
npm run dev
```

### 打包发布

根据你的操作系统构建生产环境包：

```bash
# macOS
npm run build:mac

# Windows
npm run build:win

# Linux
npm run build:linux
```

## 📖 使用指南

### 提醒功能
1. **添加提醒**: 点击侧边栏的 `+` 按钮。输入名称（如 "BTC 15m"），选择或输入周期（分钟），设置提前提醒秒数。
2. **修改设置**: 点击侧边栏的 `设置 (齿轮)` 图标。在这里你可以切换明暗主题、更改主题色，或者上传自定义的提示音文件，以及开启/关闭语音播报。
3. **窗口置顶**: 点击侧边栏的 `图钉` 图标，激活置顶模式。
4. **删除任务**: 点击任务卡片上的 `垃圾桶` 图标，在确认弹窗中点击删除。

### 交易日志
1. **切换视图**: 点击侧边栏底部的"日志"按钮切换到交易日志视图。
2. **添加记录**: 在日志视图中点击 `+` 按钮，填写交易信息，支持粘贴截图（Ctrl+V / Cmd+V）。
3. **查看统计**: 日志视图顶部显示交易统计面板，实时更新。
4. **管理记录**: 支持删除单条记录，点击图片可预览大图。

## 📁 数据存储

- **任务数据**: 存储在用户数据目录的 `tasks.db` (NeDB)
- **交易日志**: 存储在用户数据目录的 `journal.db` (NeDB)
- **交易图片**: 存储在用户数据目录的 `trade_images/` 文件夹
- **用户设置**: 通过 Zustand persist 中间件存储在本地存储

> **注意**: 首次启动时，如果检测到本地存储中有旧的任务数据，系统会自动将其迁移到 `tasks.db` 中，确保数据不丢失。

## License

MIT